import{tokenize as e,TokenType as r,stringify as t}from"@csstools/css-tokenizer";const n=/(?:license|copyright)/i,i=/sourceMappingURL/i,o=/(?:[\s]|\/\*)/;function minify(n){if(!n||!o.test(n))return n;if(""===n.trim())return" ";const i=e({css:n});for(let e=0;e<i.length;e++){const t=i[e];if(t[0]===r.Comment||t[0]===r.Whitespace){t[1]=" ";let n=i[e+1];for(;n&&(n[0]===r.Comment||n[0]===r.Whitespace);)n[1]="",e++,n=i[e+1]}}return t(...i)}function removeEmptyNodes(e){var r;if("rule"===e.type){if(0===(null==(r=e.nodes)?void 0:r.length)){var t;const r=e.parent;return e.remove(),0===(null==r||null==(t=r.nodes)?void 0:t.length)&&removeEmptyNodes(r),!0}}else if("atrule"===e.type){var n;if(0===(null==(n=e.nodes)?void 0:n.length)&&"layer"!==e.name.toLowerCase()){var i;const r=e.parent;return e.remove(),0===(null==r||null==(i=r.nodes)?void 0:i.length)&&removeEmptyNodes(r),!0}}return!1}const creator=()=>({postcssPlugin:"postcss-minify",OnceExit(e){e.raws={before:"",after:"\n"},e.walk((e=>{if("comment"!==e.type)if("decl"===e.type&&e.variable){var r;e.raws={...e.raws,before:minify(null==(r=e.raws)?void 0:r.before)}}else{if("atrule"===e.type){var t,o,s,l,a;if(removeEmptyNodes(e))return;return e.raws={before:minify(null==(t=e.raws)?void 0:t.before),after:minify(null==(o=e.raws)?void 0:o.after),between:minify(null==(s=e.raws)?void 0:s.between),semicolons:null==(l=e.raws)?void 0:l.semicolons,afterName:minify(null==(a=e.raws)?void 0:a.afterName)},void(e.params=minify(e.params))}if("rule"===e.type){var f,m,u;if(removeEmptyNodes(e))return;return e.raws={before:minify(null==(f=e.raws)?void 0:f.before),after:minify(null==(m=e.raws)?void 0:m.after),between:minify(null==(u=e.raws)?void 0:u.between)},void(e.selector=minify(e.selector))}var v,d,c;if("decl"===e.type)e.raws={before:minify(null==(v=e.raws)?void 0:v.before),between:minify(null==(d=e.raws)?void 0:d.between),semicolons:null==(c=e.raws)?void 0:c.semicolons,important:"decl"===e.type&&e.important?"!important":""},e.value=minify(e.value)}else{if(n.test(e.text)||i.test(e.text))return;e.remove()}}))}});creator.postcss=!0;export{creator as default};
