"use strict";var e=require("path"),s=require("@csstools/css-tokenizer"),r=require("@csstools/css-parser-algorithms");const o=/^([a-z0-9.+-]+:)?\/\//i;function rebase(s,r,t,a){if(s.startsWith("data:"))return!1;if(o.test(s))return!1;try{const e=new URL(s);if(e.port||e.protocol)return!1}catch{}const{hash:i,search:l}=new URL(s,"https://example.com/"),n=e.posix.resolve(e.posix.join(r.replace(new RegExp(`^${t}`),a),s));return e.posix.normalize(e.posix.relative(a,n))+l+i}const t=/url\(/i,a=/url/i,creator=()=>({postcssPlugin:"postcss-url",prepare(){const o=new WeakSet;return{Declaration(i,{result:l}){var n;if(o.has(i))return;const{from:u,to:p}=l.opts;if(!p||!u)return;const c=e.posix.parse(e.posix.resolve(p)).dir,v=null==(n=i.source)?void 0:n.input.from;if(!v)return;const f=e.posix.parse(e.posix.resolve(v)).dir,d=e.posix.parse(e.posix.resolve(u)).dir;if(!t.test(i.value))return;const m=r.parseCommaSeparatedListOfComponentValues(s.tokenize({css:i.value})),x=r.replaceComponentValues(m,(e=>{if(r.isTokenNode(e)&&e.value[0]===s.TokenType.URL){const s=rebase(e.value[4].value,f,d,c);if(s)return e.value[4].value=s,e.value[1]=`url(./${s.replaceAll(/"/g,"\\22").replaceAll(/'/g,"\\27")})`,e}if(r.isFunctionNode(e)&&a.test(e.getName()))for(const o of e.value)if(!r.isWhitespaceNode(o)&&!r.isCommentNode(o)&&r.isTokenNode(o)&&o.value[0]===s.TokenType.String){const s=rebase(o.value[4].value,f,d,c);if(s)return o.value[4].value=s,o.value[1]='"./'+s.replaceAll(/"/g,'\\"')+'"',e;break}})),h=r.stringify(x);h!==i.value&&(i.value=h,o.add(i))}}}});creator.postcss=!0,module.exports=creator;
