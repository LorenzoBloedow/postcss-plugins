"use strict";var e=require("path"),s=require("@csstools/css-tokenizer"),t=require("@csstools/css-parser-algorithms");const o=/^([a-z0-9.+-]+:)?\/\//i;function rebase(s,t,r,i){if(s.startsWith("data:"))return!1;if(o.test(s))return!1;try{const e=new URL(s);if(e.port||e.protocol)return!1}catch{}const a=e.posix.resolve(e.posix.join(t.replace(new RegExp(`^${r}`),i),s));return e.posix.normalize(e.posix.relative(i,a))}function serializeString(e){let s="";for(const t of e){const e=t.codePointAt(0);if(void 0!==e)switch(e){case 0:s+=String.fromCodePoint(65533);break;case 127:s+=`\\${e.toString(16)}`;break;case 34:case 39:case 92:s+=`\\${t}`;break;default:if(1<=e&&e<=31){s+=`\\${e.toString(16)} `;break}s+=t}else s+=String.fromCodePoint(65533)}return s}function toPosixPath(s){return s.split(e.sep).join(e.posix.sep)}const r=/url\(/i,i=/url/i,creator=()=>({postcssPlugin:"postcss-rebase-url",prepare(){const o=new WeakSet;return{Declaration(a,{result:n}){var u;if(o.has(a))return;const{from:l,to:c}=n.opts;if(!c||!l)return;const p=e.posix.parse(e.posix.resolve(toPosixPath(c))).dir,f=null==(u=a.source)?void 0:u.input.from;if(!f)return;const v=e.posix.parse(e.posix.resolve(toPosixPath(f))).dir,d=e.posix.parse(e.posix.resolve(toPosixPath(l))).dir;if(!r.test(a.value))return;const x=t.parseCommaSeparatedListOfComponentValues(s.tokenize({css:a.value})),m=t.replaceComponentValues(x,(e=>{if(t.isTokenNode(e)&&e.value[0]===s.TokenType.URL){const s=rebase(e.value[4].value,v,d,p);if(s)return e.value[4].value=s,e.value[1]=`url(./${serializeString(s)})`,e}if(t.isFunctionNode(e)&&i.test(e.getName()))for(const o of e.value)if(!t.isWhitespaceNode(o)&&!t.isCommentNode(o)&&t.isTokenNode(o)&&o.value[0]===s.TokenType.String){const s=rebase(o.value[4].value,v,d,p);if(s)return o.value[4].value=s,o.value[1]=`"./${serializeString(s)}"`,e;break}})),g=t.stringify(m);g!==a.value&&(a.value=g,o.add(a))}}}});creator.postcss=!0,module.exports=creator;
